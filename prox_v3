import streamlit as st
import pandas as pd
from itertools import combinations
import datetime

st.set_page_config(layout="wide")
st.title("Proximity Match & Trio Analyzer")

# --- File Upload ---
uploaded_file = st.file_uploader("Upload your CSV file", type=["csv"])
if not uploaded_file:
    st.stop()

# Read and clean the CSV
df = pd.read_csv(uploaded_file)

# Safe conversions
for col in ['Arrival', 'Departure']:
    if col in df.columns:
        df[col] = pd.to_datetime(df[col], errors='coerce')
    else:
        st.error(f"Missing expected column: {col}")
        st.stop()

# Convert key columns
df['M Name'] = pd.to_numeric(df['M Name'], errors='coerce')
df['Output'] = pd.to_numeric(df['Output'], errors='coerce')
df['Origin'] = pd.to_numeric(df['Origin'], errors='coerce')
df['Day'] = df['Day'].astype(str)

# Drop rows with invalid Arrival or Output
initial_len = len(df)
df = df.dropna(subset=['Arrival', 'Output'])
removed_rows = initial_len - len(df)
if removed_rows > 0:
    st.warning(f"{removed_rows} rows removed due to invalid Arrival or Output values.")

# --- Query Functions ---

def match_1_to_0(df, targe_
